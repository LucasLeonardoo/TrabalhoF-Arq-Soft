var ObterBatalha,MontarTabuleiro;$(function(){function a(a){0==a.Estado?null==a.ExercitoPretoId||null==a.ExercitoBrancoId?((null!=a.ExercitoPreto&&a.ExercitoPreto.Usuario.Email==sessionStorage.getItem("EmailUsuario")||null!=a.ExercitoBranco&&a.ExercitoBranco.Usuario.Email==sessionStorage.getItem("EmailUsuario"))&&alert("Somente existe um jogador neste jogo. Favor esperar a entrada do outro jogador"),alert("O jogo encontra-se em um estado inconsistente. Por favor, espere.")):alert("Volte ao Lobby para iniciar o jogo."):(MontarTabuleiro(a),10==a.Estado||99==a.Estado)}var b=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),c=null,d=null,e=null,f=null,g=null,h=!1,i=sessionStorage.getItem("accessToken");ObterBatalha=function(c,d=!1){var e={};i&&(e.Authorization=i),$.ajax({type:"GET",url:b+"/api/BatalhasAPI/"+c,headers:e}).done(function(b){(!d||isMeuTurno(b))&&a(b)}).fail(function(a){alert("C\xF3digo de Erro: "+a.status+"\n\n"+a.responseText)})},MontarTabuleiro=function(a){function k(a){return a.turnoId==a.exercitoBrancoId?a.exercitoBranco:a.exercitoPreto}function l(a){return ExercitoTurno=k(a),ExercitoTurno.usuario.email==t||ExercitoTurno.usuario.username==t}function m(a){return $("#"+a).children("img:first").attr("id")}function n(a){$.ajax({type:"POST",url:b+"/api/BatalhasAPI/Jogar",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(a)}).done(function(a){MontarTabuleiro(a)}).fail(function(a){alert("C\xF3digo de Erro: "+a.status+"\n\n"+a.responseText)})}e=[];var o,p=a,q=p.tabuleiro.elementosDoExercito,r=p.exercitoBrancoId,s=p.exercitoPretoId,t=sessionStorage.getItem("EmailUsuario");for($("#tabuleiro").empty(),o=0;o<p.tabuleiro.altura;o++)for($("#tabuleiro").append("<div id='linha_"+o.toString()+"' class='linha' >"),e[o]=[],j=0;j<p.tabuleiro.largura;j++){var u="casa_"+o.toString()+"_"+j.toString(),v=0==o%2?0==j%2?"casa_branca":"casa_preta":0==j%2?"casa_preta":"casa_branca";for($("#linha_"+o.toString()).append("<div id='"+u+"' class='casa "+v+"' />"),x=0;x<q.length;x++)0>=q[x].saude||q[x].posicao.altura==o&&q[x].posicao.largura==j&&(e[o][j]=q[x],q[x].exercitoId==r?$("#"+u).append("<img src='https://www.w3schools.com/images/compatible_firefox.gif' class='peca' id='"+u.replace("casa","peca_preta")+"'/>"):q[x].exercitoId==s&&$("#"+u).append("<img src='https://www.w3schools.com/images/compatible_safari.gif' class='peca' id='"+u.replace("casa","peca_branca")+"'/>"))}$(".casa").click(function(){$("#"+c).removeClass("casa_selecionada"),c=$(this).attr("id"),$("#"+c).addClass("casa_selecionada"),$("#info_casa_selecionada").text(c);var a=c.split("_")[1],b=c.split("_")[2];if(null==g)d=m(c),null==d?(g=null,d="NENHUMA PECA SELECIONADA"):(g=document.getElementById(d),f=e[a][b]),$("#info_peca_selecionada").text(d.toString());else{ataque=null!=m(c);var h={posicao:{Altura:a,Largura:b},AutorId:k(p).usuarioId,BatalhaId:p.id,ElementoId:f.id,TipoMovimento:ataque?"Atacar":"Mover"};l(p)&&k(p).id==f.exercitoId?n(h):l(p)?k(p).id!=f.exercitoId&&alert("N\xE3o \xE9 o seu exercito!"):alert("N\xE3o \xE9 a sua vez!"),g=null,$("#"+c).removeClass("casa_selecionada")}}),l(p)?(!h&&window.setInterval(function(){ObterBatalha(p.id)},1e3),h=!0):h=!1}});